<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Zero Trust on endpointmgt.com</title><link>https://endpointmgt.com/tags/zero-trust/</link><description>Recent content in Zero Trust on endpointmgt.com</description><generator>Hugo -- gohugo.io</generator><language>en-us</language><lastBuildDate>Mon, 22 Jan 2024 10:59:19 +0100</lastBuildDate><atom:link href="https://endpointmgt.com/tags/zero-trust/index.xml" rel="self" type="application/rss+xml"/><item><title>Missing Microsoft Enrolment App</title><link>https://endpointmgt.com/p/recreateenrolmentapp/</link><pubDate>Mon, 22 Jan 2024 10:59:19 +0100</pubDate><guid>https://endpointmgt.com/p/recreateenrolmentapp/</guid><description>&lt;img src="https://endpointmgt.com/p/recreateenrolmentapp/post/MissingEnrolmentApp/img/cover.png" alt="Featured image of post Missing Microsoft Enrolment App" /&gt;&lt;p&gt;Missing this app in your M365 tenant and need it for Conditional Access? This was a recent issue that I came across while working on a tenant to tenant migration project. The Issue? Re-enrolling fully managed (COPE) devices and the requirement to exclude the enrollment from MFA prompts. The only problem, only the Microsoft Intune app existed.&lt;/p&gt;
&lt;p&gt;As you can see below, the Microsoft Intune app is missing from the Mobility MDM and WIP page.&lt;/p&gt;
&lt;p&gt;&lt;img src="https://endpointmgt.com/p/recreateenrolmentapp/post/MissingEnrolmentApp/img/image-1.png"
width="474"
height="223"
srcset="https://endpointmgt.com/p/recreateenrolmentapp/post/MissingEnrolmentApp/img/image-1_hu_149ae6245f80ea59.png 480w, https://endpointmgt.com/p/recreateenrolmentapp/post/MissingEnrolmentApp/img/image-1_hu_1f6a1c3cc9ab2c2d.png 1024w"
loading="lazy"
alt="Missing Enrolment App"
class="gallery-image"
data-flex-grow="212"
data-flex-basis="510px"
&gt;&lt;/p&gt;
&lt;p&gt;As you can also see, it’s missing from the Target Resources within the Conditional Access Policies.&lt;/p&gt;
&lt;p&gt;&lt;img src="https://endpointmgt.com/p/recreateenrolmentapp/post/MissingEnrolmentApp/img/image-2.png"
width="889"
height="569"
srcset="https://endpointmgt.com/p/recreateenrolmentapp/post/MissingEnrolmentApp/img/image-2_hu_b4d59fee4348dda3.png 480w, https://endpointmgt.com/p/recreateenrolmentapp/post/MissingEnrolmentApp/img/image-2_hu_986cb2746ac23284.png 1024w"
loading="lazy"
alt="Conditional Access Selection"
class="gallery-image"
data-flex-grow="156"
data-flex-basis="374px"
&gt;&lt;/p&gt;
&lt;p&gt;To resolve the issue, we need a way of recreating the app that Microsoft will recognise as the Intune enrolment app, we can’t simply create an Enterprise Application called the same name. We’ll do this by creating a new Service Principle.&lt;/p&gt;
&lt;p&gt;First, we’re going to login to Entra ID using Powershell.&lt;/p&gt;
&lt;p&gt;&lt;code&gt;Connect-AzureAD&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src="https://endpointmgt.com/p/recreateenrolmentapp/post/MissingEnrolmentApp/img/image-3.png"
width="951"
height="211"
srcset="https://endpointmgt.com/p/recreateenrolmentapp/post/MissingEnrolmentApp/img/image-3_hu_778087c9b4995078.png 480w, https://endpointmgt.com/p/recreateenrolmentapp/post/MissingEnrolmentApp/img/image-3_hu_3a1557af93c77bcc.png 1024w"
loading="lazy"
alt="Connect to Entra"
class="gallery-image"
data-flex-grow="450"
data-flex-basis="1081px"
&gt;&lt;/p&gt;
&lt;p&gt;Lets now check if the app exists, run the get command to see if it exists.&lt;/p&gt;
&lt;p&gt;&lt;code&gt;Get-AzureADServicePrincipal -AppId d4ebce55-015a-49b5-a083-c84d1797ae8c&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;If it returned nothing back and simply returned back to a new command line, then we need to create the app. We’ll first clear any record of it from the tenant by removing the SP.&lt;/p&gt;
&lt;p&gt;&lt;code&gt;Remove-AzureADServicePrincipal -AppId d4ebce55-015a-49b5-a083-c84d1797ae8c&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;Once complete, we’re now going to recreate it. Don’t make any changes to the command.&lt;/p&gt;
&lt;p&gt;&lt;code&gt;New-AzureADServicePrincipal -AppId d4ebce55-015a-49b5-a083-c84d1797ae8c&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;To confirm it’s created, PS will show you the new Service Principle with the correct display name of the require Intune enrollment app.&lt;/p&gt;
&lt;p&gt;&lt;img src="https://endpointmgt.com/p/recreateenrolmentapp/post/MissingEnrolmentApp/img/image-4.png"
width="975"
height="205"
srcset="https://endpointmgt.com/p/recreateenrolmentapp/post/MissingEnrolmentApp/img/image-4_hu_27ce7b049dcda6d0.png 480w, https://endpointmgt.com/p/recreateenrolmentapp/post/MissingEnrolmentApp/img/image-4_hu_1d96ea3f53c16b2b.png 1024w"
loading="lazy"
alt="Create Entra Service Principal"
class="gallery-image"
data-flex-grow="475"
data-flex-basis="1141px"
&gt;&lt;/p&gt;
&lt;p&gt;We can now also see the app listed in the Mobility page&lt;/p&gt;
&lt;p&gt;&lt;img src="https://endpointmgt.com/p/recreateenrolmentapp/post/MissingEnrolmentApp/img/image-5.png"
width="458"
height="267"
srcset="https://endpointmgt.com/p/recreateenrolmentapp/post/MissingEnrolmentApp/img/image-5_hu_dfcaba243878ab7b.png 480w, https://endpointmgt.com/p/recreateenrolmentapp/post/MissingEnrolmentApp/img/image-5_hu_f847b448a2cef91.png 1024w"
loading="lazy"
alt="Mobility Page"
class="gallery-image"
data-flex-grow="171"
data-flex-basis="411px"
&gt;&lt;/p&gt;
&lt;p&gt;And, if you now select the app from the CA policy, it should be listed. You’ll need to refresh the page if you still have it open from checking previously.&lt;/p&gt;
&lt;p&gt;&lt;img src="https://endpointmgt.com/p/recreateenrolmentapp/post/MissingEnrolmentApp/img/image-6.png"
width="900"
height="568"
srcset="https://endpointmgt.com/p/recreateenrolmentapp/post/MissingEnrolmentApp/img/image-6_hu_49ecd5a2d22e3b8b.png 480w, https://endpointmgt.com/p/recreateenrolmentapp/post/MissingEnrolmentApp/img/image-6_hu_d88e477dc2e03f28.png 1024w"
loading="lazy"
alt="Updated Conditional Access Selection"
class="gallery-image"
data-flex-grow="158"
data-flex-basis="380px"
&gt;&lt;/p&gt;
&lt;p&gt;And your done. Now all you have to do is save your CA policy and test the results.&lt;/p&gt;</description></item></channel></rss>