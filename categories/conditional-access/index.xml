<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
    <channel>
        <title>Conditional Access on endpointmgt.com</title>
        <link>http://localhost:1313/categories/conditional-access/</link>
        <description>Recent content in Conditional Access on endpointmgt.com</description>
        <generator>Hugo -- gohugo.io</generator>
        <language>en-us</language>
        <lastBuildDate>Mon, 01 Sep 2025 16:23:48 +0100</lastBuildDate><atom:link href="http://localhost:1313/categories/conditional-access/index.xml" rel="self" type="application/rss+xml" /><item>
        <title>Conditional Access and MFA on Shared Windows Devices with Intune</title>
        <link>http://localhost:1313/p/intune-shared-devices-mfa-conditional-access/</link>
        <pubDate>Mon, 01 Sep 2025 16:23:48 +0100</pubDate>
        
        <guid>http://localhost:1313/p/intune-shared-devices-mfa-conditional-access/</guid>
        <description>&lt;img src="http://localhost:1313/p/intune-shared-devices-mfa-conditional-access/post/SharedWindowsDeviceandMFA/Img/cover.png" alt="Featured image of post Conditional Access and MFA on Shared Windows Devices with Intune" /&gt;&lt;p&gt;Imagine the scene; You&amp;rsquo;ve started to adopt Microsoft Intune for device management, moving fully to the cloud. ✅ Getting shot of Group Policy management and even Configuration Manager ✅, you&amp;rsquo;ve nailed single user affinity devices ✅ and even rolled out &lt;a class=&#34;link&#34; href=&#34;http://localhost:1313/p/whfbcloudkerberos/&#34; &gt;Windows Hello for Business&lt;/a&gt; ✅ to improve the user sign in experience and security. You then turn your hand to shared devices and its not going so well. It works ✅ — but it isn’t seamless ⚠️. Did you know your MFA configuration might be the culprit?&lt;/p&gt;
&lt;p&gt;Shared Windows devices in teaching labs, libraries, and lecture theatres need to “just work.” But when Microsoft Intune and Conditional Access are combined with Windows Autopilot pre-provisioning, things can go wrong in unexpected ways.&lt;/p&gt;
&lt;p&gt;A common issue we’ve seen is that MFA never prompts the user during login. On the surface, this might look like a smoother experience. In reality, it means no Primary Refresh Token (PRT) is established and without a PRT, seamless SSO fails. The knock-on effect is that students (or staff) can’t sync Company Portal policies, device configuration stalls, and Windows subscription activation doesn’t apply correctly.&lt;/p&gt;
&lt;h2 id=&#34;why-it-happens&#34;&gt;Why It Happens
&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;Shared Windows devices (Azure AD joined, Intune managed, no primary user) don’t issue MFA at login.&lt;/li&gt;
&lt;li&gt;Conditional Access policies apply to all users and apps without exclusions.&lt;/li&gt;
&lt;li&gt;Non-interactive logins (Company Portal, Intune MDM, Windows licensing) then try to authenticate — but get blocked silently by Conditional Access because MFA is required but not triggered.&lt;/li&gt;
&lt;li&gt;Result: Company Portal only partially works, device policies sit as “Pending,” and subscription activation is delayed.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;Interactive vs. Non-Interactive Sign-Ins in Entra ID&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;When a user signs in to a device or application, Entra ID records the sign-in as either interactive or non-interactive.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;http://localhost:1313/p/intune-shared-devices-mfa-conditional-access/post/SharedWindowsDeviceandMFA/Img/logintype.png&#34;
	width=&#34;1220&#34;
	height=&#34;256&#34;
	srcset=&#34;http://localhost:1313/p/intune-shared-devices-mfa-conditional-access/post/SharedWindowsDeviceandMFA/Img/logintype_hu_f1eac52d6d48ce4e.png 480w, http://localhost:1313/p/intune-shared-devices-mfa-conditional-access/post/SharedWindowsDeviceandMFA/Img/logintype_hu_f3287712bd1400c.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;Entra Sign in&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;476&#34;
		data-flex-basis=&#34;1143px&#34;
	
&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Interactive sign-ins occur when the user is directly prompted to enter their credentials or complete an MFA challenge. This includes typing in a password, using Windows Hello, or approving a prompt on their phone. Interactive sign-ins always involve visible user interaction.&lt;/li&gt;
&lt;li&gt;Non-interactive sign-ins happen silently in the background, usually when a token is being refreshed or when applications/services request access on behalf of the user. For example, Microsoft Intune, Company Portal, or Office apps will often use non-interactive sign-ins to request tokens without interrupting the user.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;The distinction matters in Conditional Access: if MFA is required on a non-interactive sign-in, the user won’t see a prompt right away. Instead, the process fails until something triggers an interactive sign-in, which can lead to confusion and policy mis-applications on shared devices.&lt;/p&gt;
&lt;h2 id=&#34;the-user-experience&#34;&gt;The user experience
&lt;/h2&gt;&lt;p&gt;Instead of being prompted for MFA at sign-in, students only discover the problem when:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Device configuration targeted at the user is delayed&lt;/li&gt;
&lt;li&gt;OneDrive sync client doesn&amp;rsquo;t automatically sign in and re-direct folders&lt;/li&gt;
&lt;li&gt;Edge automatic sign in and sync doesn&amp;rsquo;t automatically sign in and provide your user preferences&lt;/li&gt;
&lt;li&gt;Outlook prompts the user for their email address upon first launch&lt;/li&gt;
&lt;li&gt;Windows Enterprise/Education edition activation is delayed&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;In teaching environments, this disruption is magnified — students move rapidly between machines, and IT staff can’t troubleshoot MFA prompts that never appear.&lt;/p&gt;
&lt;h2 id=&#34;issue-confirmation&#34;&gt;Issue confirmation
&lt;/h2&gt;&lt;p&gt;So you&amp;rsquo;ve read this far and wonder if the user experience witnessed is caused by Conditional Access too? Let&amp;rsquo;s confirm before remediating.&lt;/p&gt;
&lt;p&gt;You can first this in 2 way; one the affected device or via the entra sign in logs.&lt;/p&gt;
&lt;h3 id=&#34;on-the-device&#34;&gt;On the device
&lt;/h3&gt;&lt;p&gt;The simplest way to check is get the user to login and launch the start menu. Select their user account icon (either their picture or initials, if they don&amp;rsquo;t have a picture), if MFA is at fault here, they&amp;rsquo;ll get&amp;hellip;&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;http://localhost:1313/p/intune-shared-devices-mfa-conditional-access/post/SharedWindowsDeviceandMFA/Img/verifyprompt.png&#34;
	width=&#34;528&#34;
	height=&#34;324&#34;
	srcset=&#34;http://localhost:1313/p/intune-shared-devices-mfa-conditional-access/post/SharedWindowsDeviceandMFA/Img/verifyprompt_hu_23eba057a30810c5.png 480w, http://localhost:1313/p/intune-shared-devices-mfa-conditional-access/post/SharedWindowsDeviceandMFA/Img/verifyprompt_hu_8d4d39ced900282d.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;Verify Account Prompt&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;162&#34;
		data-flex-basis=&#34;391px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;They can always verify account here and configuration will start to apply but by this point, the damage to SSO and the user experience is already disrupted. Not to mention that they might need to log off and on to get OneDrive, Edge and other configuration to automatically apply.&lt;/p&gt;
&lt;h3 id=&#34;entra-logs&#34;&gt;Entra Logs
&lt;/h3&gt;&lt;p&gt;You&amp;rsquo;ll need a role that allows access to user sign in logs and conditional access (to see the problematic policy report). Remember that sign in logs take around 10 minutes to populate so log into an affected device and wait before looking to the logs.&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Navigate to &lt;kbd&gt;entra.microsoft.com&lt;/kbd&gt;&lt;/li&gt;
&lt;li&gt;Go to &lt;kbd&gt;Entra ID &amp;gt; Users &amp;gt; Select test User &amp;gt; Sign In Logs&lt;/kbd&gt;&lt;/li&gt;
&lt;li&gt;Select &lt;kbd&gt;User sign-ins (non-interactive)&lt;/kbd&gt;&lt;/li&gt;
&lt;li&gt;Now look for an interrupted sign in for Windows Search, Device Management&amp;hellip;&lt;/li&gt;
&lt;li&gt;Select the &lt;kbd&gt;sign in log&lt;/kbd&gt;, it might be under aggregate, if so select that line and select the &lt;kbd&gt;expanded record&lt;/kbd&gt;&lt;/li&gt;
&lt;li&gt;You&amp;rsquo;ll see the basic authentication information with a message such as Failure Reason&lt;/li&gt;
&lt;li&gt;Select &lt;kbd&gt;Conditional Access&lt;/kbd&gt;&lt;/li&gt;
&lt;li&gt;Here you&amp;rsquo;ll the policy causing the issue&lt;/li&gt;
&lt;li&gt;You&amp;rsquo;ll see within the grant control required.&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;intune-conditional-access-remediation-options-for-mfa-on-shared-devices&#34;&gt;Intune Conditional Access Remediation Options for MFA on Shared Devices
&lt;/h2&gt;&lt;p&gt;Now that you&amp;rsquo;ve confirmed the issue, we need a solution! To balance security and usability, organisations need to exclude shared devices from strict MFA requirements, while still maintaining strong controls elsewhere.&lt;/p&gt;
&lt;h3 id=&#34;which-approach-should-you-use&#34;&gt;Which Approach Should You Use?
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;✅ &lt;strong&gt;Exclude Intune / Windows Store for Business&lt;/strong&gt; → if device sync and subscription activation are the main blockers.&lt;/li&gt;
&lt;li&gt;✅ &lt;strong&gt;Filter by Enrollment Profile&lt;/strong&gt; → if all shared devices use a dedicated Autopilot profile.&lt;/li&gt;
&lt;li&gt;✅ &lt;strong&gt;Filter by Extension Attribute&lt;/strong&gt; → if you need granular control across mixed Autopilot profiles or to tag only specific labs.&lt;/li&gt;
&lt;li&gt;❌ &lt;strong&gt;Exclude by Network Location&lt;/strong&gt; → only safe if you can guarantee shared devices are the only ones using those public IPs. Avoid if BYOD devices connect to the same network.&lt;/li&gt;
&lt;li&gt;❌ &lt;strong&gt;Introduce Web Signin&lt;/strong&gt; → only safe if you can guarantee shared devices will always have an internet connection.&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;exclude-microsoft-intune&#34;&gt;Exclude Microsoft Intune
&lt;/h3&gt;&lt;p&gt;To prevent Company Portal and user initiated sync&amp;rsquo;s with Microsoft Intune being affected by your conditional access, the best advice would be to simply exclude the app entirely from the offending CA.&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Navigate to &lt;kbd&gt;entra.microsoft.com&lt;/kbd&gt;&lt;/li&gt;
&lt;li&gt;Go to &lt;kbd&gt;Entra ID &amp;gt; Conditional Access &amp;gt; Policies&lt;/kbd&gt;&lt;/li&gt;
&lt;li&gt;Select the MFA policy (remember you might have more than one, so repeat steps 4-9)&lt;/li&gt;
&lt;/ol&gt;
&lt;ul&gt;
&lt;li&gt;It might be a good idea here to review your other policies for grant controls and consider adding this exclude to those too. For example &amp;ldquo;Require Compliant devices&amp;rdquo;.&lt;/li&gt;
&lt;/ul&gt;
&lt;ol start=&#34;4&#34;&gt;
&lt;li&gt;Select &lt;kbd&gt;Target resources&lt;/kbd&gt;&lt;/li&gt;
&lt;li&gt;Select &lt;kbd&gt;Exclude&lt;/kbd&gt;&lt;/li&gt;
&lt;li&gt;Select &lt;kbd&gt;Select or the blue text below select&lt;/kbd&gt;&lt;/li&gt;
&lt;li&gt;Search for and select &amp;ldquo;Microsoft Intune&amp;rdquo;. If this doesn&amp;rsquo;t appear, depending on your tenant look for &amp;ldquo;Microsoft.Intune&amp;rdquo; It&amp;rsquo;s the same App ID but some tenants have a dot in the middle. Good old Microsoft.&lt;/li&gt;
&lt;li&gt;Select the blue &lt;kbd&gt;Select&lt;/kbd&gt; button
&lt;ul&gt;
&lt;li&gt;Example screenshot of the policy filter in action:;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;img src=&#34;http://localhost:1313/p/intune-shared-devices-mfa-conditional-access/post/SharedWindowsDeviceandMFA/Img/ExIntune.png&#34;
	width=&#34;598&#34;
	height=&#34;872&#34;
	srcset=&#34;http://localhost:1313/p/intune-shared-devices-mfa-conditional-access/post/SharedWindowsDeviceandMFA/Img/ExIntune_hu_eb4f0c1c40f87043.png 480w, http://localhost:1313/p/intune-shared-devices-mfa-conditional-access/post/SharedWindowsDeviceandMFA/Img/ExIntune_hu_823876bebb4949e0.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;Exclude Microsoft Intune&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;68&#34;
		data-flex-basis=&#34;164px&#34;
	
&gt;&lt;/p&gt;
&lt;ol start=&#34;9&#34;&gt;
&lt;li&gt;Save the policy.&lt;/li&gt;
&lt;li&gt;The policy will be updated with the new exclusion and take around 20 minutes to apply.&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id=&#34;exclude-windows-store-for-business&#34;&gt;Exclude Windows Store for Business
&lt;/h3&gt;&lt;p&gt;In the same way as Microsoft Intune. Subscription Activation of Windows is handled by Windows Store for Business. If devices are failing to uplift to Enterprise, exclude the Windows Store for Business Enterprise app entirely from the offending CA. Microsoft also include this in their &lt;a class=&#34;link&#34; href=&#34;https://learn.microsoft.com/en-us/windows/deployment/windows-subscription-activation?pivots=windows-11#adding-conditional-access-policy&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;documentation.&lt;/a&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Navigate to &lt;kbd&gt;entra.microsoft.com&lt;/kbd&gt;&lt;/li&gt;
&lt;li&gt;Go to &lt;kbd&gt;Entra ID &amp;gt; Conditional Access &amp;gt; Policies&lt;/kbd&gt;&lt;/li&gt;
&lt;li&gt;Select the MFA policy (remember you might have more than one, so repeat steps 4-9)
&lt;ul&gt;
&lt;li&gt;It might be a good idea here to review you&amp;rsquo;re other policies for grant controls and consider adding this exclude to those too.&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Select &lt;kbd&gt;Target resources&lt;/kbd&gt;&lt;/li&gt;
&lt;li&gt;Select &lt;kbd&gt;Exclude&lt;/kbd&gt;&lt;/li&gt;
&lt;li&gt;Select &lt;kbd&gt;Select or the blue text below select&lt;/kbd&gt;&lt;/li&gt;
&lt;li&gt;Search for and select &amp;ldquo;Windows Store for Business&amp;rdquo;. If this doesn&amp;rsquo;t appear, depending on your tenant look for &amp;ldquo;Universal Store Service APIs and Web Application&amp;rdquo; It&amp;rsquo;s the same App ID as the Windows Store.&lt;/li&gt;
&lt;li&gt;Select the blue &lt;kbd&gt;Select&lt;/kbd&gt; button
&lt;ul&gt;
&lt;li&gt;Example screenshot of the policy filter in action:;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;img src=&#34;http://localhost:1313/p/intune-shared-devices-mfa-conditional-access/post/SharedWindowsDeviceandMFA/Img/ExWindowsStore.png&#34;
	width=&#34;626&#34;
	height=&#34;864&#34;
	srcset=&#34;http://localhost:1313/p/intune-shared-devices-mfa-conditional-access/post/SharedWindowsDeviceandMFA/Img/ExWindowsStore_hu_ecb07e1367863d07.png 480w, http://localhost:1313/p/intune-shared-devices-mfa-conditional-access/post/SharedWindowsDeviceandMFA/Img/ExWindowsStore_hu_ba06b3b52216a959.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;Exclude Windows Store for Business&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;72&#34;
		data-flex-basis=&#34;173px&#34;
	
&gt;&lt;/p&gt;
&lt;ol start=&#34;9&#34;&gt;
&lt;li&gt;&lt;kbd&gt;Save&lt;/kbd&gt; the policy.&lt;/li&gt;
&lt;li&gt;The policy will be updated with the new exclusion and take around 20 minutes to apply.&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id=&#34;filter-for-shared-devices&#34;&gt;Filter for shared devices
&lt;/h3&gt;&lt;p&gt;Now comes the fun part! Depending on your environment will depend on the best approach here. I&amp;rsquo;ll cover off a general exclude and then a 2 tailored options for shared devices.&lt;/p&gt;
&lt;h4 id=&#34;network-approach&#34;&gt;Network Approach
&lt;/h4&gt;&lt;p&gt;This option only works if you want to exclude all devices that reside on your internal network. If you have other device use cases or allow users to connect personal devices to the same network, even connected to different vlans, this isn&amp;rsquo;t the option for you. To clarify, if internet traffic for these devices is all route through the same public IP addresses to M365, I don&amp;rsquo;t recommend this approach. Be warned!&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Obtain your public facing IP address(es)&lt;/li&gt;
&lt;li&gt;Navigate to &lt;kbd&gt;entra.microsoft.com&lt;/kbd&gt;&lt;/li&gt;
&lt;li&gt;Go to &lt;kbd&gt;Entra ID &amp;gt; Conditional Access &amp;gt; Named Locations&lt;/kbd&gt;&lt;/li&gt;
&lt;li&gt;Review the IP ranges locations to ensure you don&amp;rsquo;t already have these setup. If you do, skip to step X&lt;/li&gt;
&lt;li&gt;Select &lt;kbd&gt;IP Ranges location&lt;/kbd&gt;&lt;/li&gt;
&lt;li&gt;Provide a name such as the location or campus&lt;/li&gt;
&lt;li&gt;Click on the &lt;kbd&gt;+&lt;/kbd&gt; icon&lt;/li&gt;
&lt;li&gt;Add the IPv4 range with /24 or/32 etc (I won&amp;rsquo;t explain these here)&lt;/li&gt;
&lt;li&gt;Select &lt;kbd&gt;Add&lt;/kbd&gt;&lt;/li&gt;
&lt;li&gt;Navigate to &lt;kbd&gt;Entra ID &amp;gt; Conditional Access &amp;gt; Policies&lt;/kbd&gt;&lt;/li&gt;
&lt;li&gt;Select the MFA policy&lt;/li&gt;
&lt;li&gt;Select &lt;kbd&gt;Network&lt;/kbd&gt;&lt;/li&gt;
&lt;li&gt;Select &lt;kbd&gt;Yes&lt;/kbd&gt; on Configure&lt;/li&gt;
&lt;li&gt;Select &lt;kbd&gt;Exclude&lt;/kbd&gt;&lt;/li&gt;
&lt;li&gt;Select &lt;kbd&gt;Selected network and locations&lt;/kbd&gt;&lt;/li&gt;
&lt;li&gt;Select &lt;kbd&gt;None&lt;/kbd&gt;&lt;/li&gt;
&lt;li&gt;Add the newly added or existing named location and select &lt;kbd&gt;Save&lt;/kbd&gt;
&lt;ul&gt;
&lt;li&gt;Example screenshot of the policy filter in action:;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;img src=&#34;http://localhost:1313/p/intune-shared-devices-mfa-conditional-access/post/SharedWindowsDeviceandMFA/Img/ExcludeNetworkLocation.png&#34;
	width=&#34;746&#34;
	height=&#34;716&#34;
	srcset=&#34;http://localhost:1313/p/intune-shared-devices-mfa-conditional-access/post/SharedWindowsDeviceandMFA/Img/ExcludeNetworkLocation_hu_85f0b295908d9ed1.png 480w, http://localhost:1313/p/intune-shared-devices-mfa-conditional-access/post/SharedWindowsDeviceandMFA/Img/ExcludeNetworkLocation_hu_479498d75a243e61.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;Exclude Network Location&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;104&#34;
		data-flex-basis=&#34;250px&#34;
	
&gt;&lt;/p&gt;
&lt;ol start=&#34;18&#34;&gt;
&lt;li&gt;Remember to then &lt;kbd&gt;Save&lt;/kbd&gt; the conditional access policy.&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;Now that you&amp;rsquo;ve excluded the MFA from the named location, the policy will take around 20 minutes to update and from then, MFA will not prompt users on this network. If you&amp;rsquo;ve selected the route, it would be a good idea to add an additional MFA policy that is targeted to this network. For example you could have a policy that includes this network but only targets the browser and Office 365.&lt;/p&gt;
&lt;p&gt;Note- This will only work if devices are logging in, when on your network. If they take a shared device home and login for the first time, this solution doesn&amp;rsquo;t address the issue. Keep reading ;).&lt;/p&gt;
&lt;h4 id=&#34;filter-for-devices-approach&#34;&gt;Filter for Devices Approach
&lt;/h4&gt;&lt;p&gt;You&amp;rsquo;re still with us. Good, this is where it gets interesting and becomes tailored to your device use case. If you only want to exclude the shared devices from the policies, this is where we&amp;rsquo;ll use Filter for Devices. It&amp;rsquo;s been around for quite some time but in my experience, it&amp;rsquo;s relatively less known.&lt;/p&gt;
&lt;p&gt;You can use &amp;ldquo;Filter for Devices&amp;rdquo; within a Conditional Access policy to control if it should or shouldn&amp;rsquo;t apply via includes and excludes criteria. There are a number of filter options that can be selected. From Intune Compliance state, Device Name, EnrolmentProfileName and so on. Some of these are safer to use than others. I&amp;rsquo;d recommend not using a filter that a user could manipulate. For example a user could change their Device Name for exclude their device from a targeted CA policy.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;http://localhost:1313/p/intune-shared-devices-mfa-conditional-access/post/SharedWindowsDeviceandMFA/Img/CA-FilterforDevices.png&#34;
	width=&#34;1615&#34;
	height=&#34;882&#34;
	srcset=&#34;http://localhost:1313/p/intune-shared-devices-mfa-conditional-access/post/SharedWindowsDeviceandMFA/Img/CA-FilterforDevices_hu_fbce869297a4cc8.png 480w, http://localhost:1313/p/intune-shared-devices-mfa-conditional-access/post/SharedWindowsDeviceandMFA/Img/CA-FilterforDevices_hu_6f288a2a7c6d923c.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;Filter for Devices&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;183&#34;
		data-flex-basis=&#34;439px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;We&amp;rsquo;ll run through 2 exclude options here, based on;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Windows Autopilot enrolment profile&lt;/strong&gt; - used by the shared devices onboarding via Windows Autopilot&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Extension Attributes&lt;/strong&gt; (often used for &lt;a class=&#34;link&#34; href=&#34;https://learn.microsoft.com/en-us/security/privileged-access-workstations/privileged-access-deployment&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;Privileged Access Workstations - PAW&lt;/a&gt;) used when you want to target all or a subset of devices.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;The mechanics behind Filter for devices is the same;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Navigate to &lt;kbd&gt;entra.microsoft.com&lt;/kbd&gt;&lt;/li&gt;
&lt;li&gt;Go to &lt;kbd&gt;Entra ID &amp;gt; Conditional Access &amp;gt; Policies&lt;/kbd&gt;&lt;/li&gt;
&lt;li&gt;Select the MFA policy&lt;/li&gt;
&lt;li&gt;Select &lt;kbd&gt;Conditions&lt;/kbd&gt;&lt;/li&gt;
&lt;li&gt;Select &lt;kbd&gt;Filter for Devices &amp;gt; Not Configured&lt;/kbd&gt;&lt;/li&gt;
&lt;li&gt;Select &lt;kbd&gt;Configure&lt;/kbd&gt;&lt;/li&gt;
&lt;li&gt;Select the radial for &lt;kbd&gt;Exclude filtered devices from policy&lt;/kbd&gt;&lt;/li&gt;
&lt;li&gt;Select the &lt;kbd&gt;property&lt;/kbd&gt; that you wish to exclude from the drop down
&lt;ul&gt;
&lt;li&gt;In our case it&amp;rsquo;ll be EnrollmentProfileName or ExtensionAttribute(1-15)&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Operator should be &amp;ldquo;Equals&amp;rdquo;&lt;/li&gt;
&lt;li&gt;Value should is a string with the value of
&lt;ul&gt;
&lt;li&gt;In our case it&amp;rsquo;ll be the EnrollmentProfileName from the Windows Autopilot Deployment Profiles blade within&lt;br&gt;
&lt;a class=&#34;link&#34; href=&#34;https://intune.microsoft.com/#view/Microsoft_Intune_Enrollment/AutopilotDeploymentProfiles.ReactView&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;Microsoft Intune&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Or a string value of our choice for the ExtensionAttribute, such as &amp;ldquo;Shared-MFAExcluded&amp;rdquo;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Select the blue &lt;kbd&gt;Done&lt;/kbd&gt; once complete
&lt;ul&gt;
&lt;li&gt;Example screenshot of the policy filter in action:;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;img src=&#34;http://localhost:1313/p/intune-shared-devices-mfa-conditional-access/post/SharedWindowsDeviceandMFA/Img/ExcludeDevice.png&#34;
	width=&#34;1609&#34;
	height=&#34;872&#34;
	srcset=&#34;http://localhost:1313/p/intune-shared-devices-mfa-conditional-access/post/SharedWindowsDeviceandMFA/Img/ExcludeDevice_hu_1e0f58111e01b414.png 480w, http://localhost:1313/p/intune-shared-devices-mfa-conditional-access/post/SharedWindowsDeviceandMFA/Img/ExcludeDevice_hu_4b20f97fdbf1159c.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;Exclude Using Filer for Devices&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;184&#34;
		data-flex-basis=&#34;442px&#34;
	
&gt;&lt;/p&gt;
&lt;ol start=&#34;12&#34;&gt;
&lt;li&gt;Remember to Save the policy to finish editing the CA policy&lt;/li&gt;
&lt;li&gt;Again, wait around 20 minutes for the policy changes to take effect.&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;If you&amp;rsquo;ve used the EnrollmentProfileName property and devices are enrolled using that deployment profile, your work here is done and you can test with a new enrolment. If however you&amp;rsquo;ve opted for ExtensionAttribute, the device(s) still need to be tagged.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Add Extension Attributes to devices&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;http://localhost:1313/p/intune-shared-devices-mfa-conditional-access/post/SharedWindowsDeviceandMFA/Img/extensionAttributeDemo.png&#34;
	width=&#34;549&#34;
	height=&#34;49&#34;
	srcset=&#34;http://localhost:1313/p/intune-shared-devices-mfa-conditional-access/post/SharedWindowsDeviceandMFA/Img/extensionAttributeDemo_hu_f7286b9865f0eb7e.png 480w, http://localhost:1313/p/intune-shared-devices-mfa-conditional-access/post/SharedWindowsDeviceandMFA/Img/extensionAttributeDemo_hu_37977331202d1b2a.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;Extension Attribute&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;1120&#34;
		data-flex-basis=&#34;2688px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;This has been covered by many blog posts over the years so I&amp;rsquo;ll keep this part brief. I might even revise this in future and profile a Powershell script to call graph, watch this space. To understand adding this attributes, you have to understand that these attributes live within Entra, not Intune. The attributes gets added to the Autopilot Entra record. The bonus is that you only ever have to do this once. The downside is that it can&amp;rsquo;t be done via the Entra portal. It has to be done via Graph.&lt;/p&gt;
&lt;p&gt;These blog posts cover how to add the extension attributes to devices&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a class=&#34;link&#34; href=&#34;https://ourcloudnetwork.com/configure-device-extension-attributes-in-azure-ad-with-powershell/&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;ourcloudnetwork.com&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class=&#34;link&#34; href=&#34;https://smbtothecloud.com/dynamically-add-device-extension-attributes-using-remediations/&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;smbtothecloud.com&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;The concept is simple however;
As an example, this script adds &amp;ldquo;Shared-MFAExcluded&amp;rdquo; to &amp;ldquo;extensionAttribute1&amp;rdquo; of a selected device, based on it&amp;rsquo;s name. I&amp;rsquo;ve kept it very simply without an if query to check the device exists etc but just so you get the concept and to allow for testing.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-Powershell&#34; data-lang=&#34;Powershell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c&#34;&gt;# Load the Microsoft Graph module&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;Import-Module&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Microsoft&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;Graph&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;Identity&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;DirectoryManagement&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c&#34;&gt;# Connect to Microsoft Graph with required permissions&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;Connect-MgGraph&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Scopes&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;Directory.ReadWrite.All&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c&#34;&gt;# Define the device name you want to update&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;$DeviceName&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;DEVENV-34429856&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c&#34;&gt;# Find the device by name&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;$Device&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;Get-MgDevice&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Filter&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;displayName eq &amp;#39;&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$DeviceName&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#39;&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c&#34;&gt;# Update extensionAttribute1&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nb&#34;&gt;Update-MgDevice&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-DeviceId&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$Device&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;Id&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-AdditionalProperties&lt;/span&gt; &lt;span class=&#34;vm&#34;&gt;@&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;s2&#34;&gt;&amp;#34;extensionAttributes&amp;#34;&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;vm&#34;&gt;@&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;s2&#34;&gt;&amp;#34;extensionAttribute1&amp;#34;&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;Shared-MFAExcluded&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;To confirm that it&amp;rsquo;s worked, you should now see the extensionAttribute within Entra&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Navigate to &lt;kbd&gt;entra.microsoft.com&lt;/kbd&gt;&lt;/li&gt;
&lt;li&gt;Go to &lt;kbd&gt;Entra ID &amp;gt; Devices &amp;gt; All Devices&lt;/kbd&gt;&lt;/li&gt;
&lt;li&gt;Search for your device&lt;/li&gt;
&lt;li&gt;Select the device, in my case &lt;kbd&gt;DEVENV-34429856&lt;/kbd&gt;&lt;/li&gt;
&lt;li&gt;At the bottom of the record you should now see the extensionAttribute set.&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;img src=&#34;http://localhost:1313/p/intune-shared-devices-mfa-conditional-access/post/SharedWindowsDeviceandMFA/Img/extensionAttributeSet.png&#34;
	width=&#34;1010&#34;
	height=&#34;821&#34;
	srcset=&#34;http://localhost:1313/p/intune-shared-devices-mfa-conditional-access/post/SharedWindowsDeviceandMFA/Img/extensionAttributeSet_hu_9533da7df157f045.png 480w, http://localhost:1313/p/intune-shared-devices-mfa-conditional-access/post/SharedWindowsDeviceandMFA/Img/extensionAttributeSet_hu_b3b9330b3bc77ff0.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;Extension Attribute Set&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;123&#34;
		data-flex-basis=&#34;295px&#34;
	
&gt;&lt;/p&gt;
&lt;ol start=&#34;6&#34;&gt;
&lt;li&gt;Now to test your policy exclusion&amp;hellip;.&lt;/li&gt;
&lt;li&gt;You should now see that the MFA policy now excludes this device from the policy&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id=&#34;an-alternative-option-web-sign-in&#34;&gt;&lt;strong&gt;An Alternative Option: Web Sign-in&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;In addition to traditional sign-in methods, &lt;strong&gt;Web sign-in&lt;/strong&gt; offers another possibility for shared devices. This option provides a streamlined experience by leveraging cloud-based authentication like MFA, Microsoft Authenticator, Temporary Access Pass (TAP), or FIDO2 security keys.&lt;/p&gt;
&lt;p&gt;The primary drawback of Web sign-in is its complete dependence on a reliable internet connection. Unlike cached credentials from a traditional password login, the Web sign-in option requires an internet connection for &lt;em&gt;every single login&lt;/em&gt;, even if the user has previously signed in to the device. This means if a device loses its network connection, users will be unable to sign in using this method.&lt;/p&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://learn.microsoft.com/en-us/windows/security/identity-protection/web-sign-in/?tabs=intune&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;More on Web Sign from Microsoft&lt;/a&gt;&lt;/p&gt;
&lt;h4 id=&#34;what-if-a-login-fails&#34;&gt;&lt;strong&gt;What if a Login Fails?&lt;/strong&gt;
&lt;/h4&gt;&lt;p&gt;You might be wondering if users will know how to switch options if their Web sign-in fails. The good news is that Windows is designed to handle this gracefully. The lock screen will always show multiple sign-in options if they are enabled on the device (e.g., password, PIN, Web sign-in).&lt;/p&gt;
&lt;p&gt;If a Web sign-in attempt fails due to a network issue, the user can simply press &lt;strong&gt;Ctrl + Alt + Delete&lt;/strong&gt; to return to the main login screen. From there, they can select an alternative sign-in method, such as a cached password or PIN, allowing them to complete their login without interruption.&lt;/p&gt;
&lt;h2 id=&#34;conclusion&#34;&gt;Conclusion
&lt;/h2&gt;&lt;p&gt;Conditional Access and MFA are essential for securing identities in Microsoft 365, but shared devices introduce edge cases that can easily break the user experience. The challenge is that non-interactive logins silently fail when MFA is required but never prompted, leaving users confused and admins troubleshooting stalled configurations.&lt;/p&gt;
&lt;p&gt;By carefully excluding the right enterprise applications, or by using targeted device filters such as Autopilot profiles or extension attributes, you can strike the balance between &lt;strong&gt;security and usability&lt;/strong&gt;. The goal isn’t to weaken MFA, but to apply it intelligently so that shared devices remain functional while personal or high-risk scenarios stay protected.&lt;/p&gt;
&lt;p&gt;As always, test exclusions thoroughly in a controlled environment before rolling them out broadly, and keep monitoring your Entra sign-in logs to validate that policies are working as intended.&lt;/p&gt;
&lt;p&gt;Done right, Conditional Access doesn’t have to be a blocker — it becomes an enabler for seamless, secure, and scalable device management in Microsoft Intune environments.&lt;/p&gt;
</description>
        </item>
        
    </channel>
</rss>
